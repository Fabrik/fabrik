var FbList=new Class({Implements:[Options,Events],options:{admin:!1,filterMethod:"onchange",ajax:!1,ajax_links:!1,links:{edit:"",detail:"",add:""},form:"listform_"+this.id,hightLight:"#ccffff",primaryKey:"",headings:[],labels:{},Itemid:0,formid:0,canEdit:!0,canView:!0,page:"index.php",actionMethod:"floating",formels:[],data:[],rowtemplate:"",floatPos:"left",csvChoose:!1,csvOpts:{},popup_width:300,popup_height:300,popup_offset_x:null,popup_offset_y:null,groupByOpts:{},listRef:"",fabrik_show_in_list:[],singleOrdering:!1,tmpl:"",groupedBy:"",toggleCols:!1},initialize:function(t,e){this.id=t,this.setOptions(e),this.getForm(),this.result=!0,this.plugins=[],this.list=document.id("list_"+this.options.listRef),this.options.j3===!1&&(this.actionManager=new FbListActions(this,{method:this.options.actionMethod,floatPos:this.options.floatPos})),this.options.toggleCols&&(this.toggleCols=new FbListToggle(this.form)),this.groupToggle=new FbGroupedToggler(this.form,this.options.groupByOpts),new FbListKeys(this),this.list&&("table"===this.list.get("tag")&&(this.tbody=this.list.getElement("tbody")),"null"===typeOf(this.tbody)&&(this.tbody=this.list),window.ie&&(this.options.rowtemplate=this.list.getElement(".fabrik_row"))),this.watchAll(!1),Fabrik.addEvent("fabrik.form.submitted",function(){this.updateRows()}.bind(this)),window.history&&history.pushState&&history.state&&this.options.ajax&&this._updateRows(history.state)},rowClicks:function(){this.list.addEvent("click:relay(.fabrik_row)",function(t,e){var i=Array.from(e.id.split("_")),n={};n.rowid=i.getLast();var s={errors:{},data:n,rowid:i.getLast(),listid:this.id};Fabrik.fireEvent("fabrik.list.row.selected",s)}.bind(this))},watchAll:function(t){t=t?t:!1,this.watchNav(),this.storeCurrentValue(),t||(this.watchRows(),this.watchFilters()),this.watchOrder(),this.watchEmpty(),t||(this.watchGroupByMenu(),this.watchButtons())},watchGroupByMenu:function(){this.options.ajax&&this.form.addEvent("click:relay(*[data-groupBy])",function(t,e){this.options.groupedBy=e.get("data-groupBy"),t.rightClick||(t.preventDefault(),this.updateRows())}.bind(this))},watchButtons:function(){this.exportWindowOpts={id:"exportcsv",title:"Export CSV",loadMethod:"html",minimizable:!1,width:360,height:120,content:"",bootstrap:this.options.j3},"csv"===this.options.view?this.openCSVWindow():this.form.getElements(".csvExportButton")&&this.form.getElements(".csvExportButton").each(function(t){t.hasClass("custom")===!1&&t.addEvent("click",function(t){this.openCSVWindow(),t.stop()}.bind(this))}.bind(this))},openCSVWindow:function(){var t=this.makeCSVExportForm();this.exportWindowOpts.content=t,this.exportWindowOpts.onContentLoaded=function(){this.fitToContent(!1)},this.csvWindow=Fabrik.getWindow(this.exportWindowOpts)},makeCSVExportForm:function(){return this.options.csvChoose?this._csvExportForm():this._csvAutoStart()},_csvAutoStart:function(){var t=new Element("div",{id:"csvmsg"}).set("html",Joomla.JText._("COM_FABRIK_LOADING")+' <br /><span id="csvcount">0</span> / <span id="csvtotal"></span> '+Joomla.JText._("COM_FABRIK_RECORDS")+".<br/>"+Joomla.JText._("COM_FABRIK_SAVING_TO")+'<span id="csvfile"></span>');return this.csvopts=this.options.csvOpts,this.csvfields=this.options.csvFields,this.triggerCSVExport(-1),t},_csvExportForm:function(){var t="<input type='radio' value='1' name='incfilters' checked='checked' />"+Joomla.JText._("JYES"),e="<input type='radio' value='1' name='incraw' checked='checked' />"+Joomla.JText._("JYES"),i="<input type='radio' value='1' name='inccalcs' checked='checked' />"+Joomla.JText._("JYES"),n="<input type='radio' value='1' name='inctabledata' checked='checked' />"+Joomla.JText._("JYES"),s="<input type='radio' value='1' name='excel' checked='checked' />Excel CSV",o="index.php?option=com_fabrik&view=list&listid="+this.id+"&format=csv&Itemid="+this.options.Itemid,a={styles:{width:"200px","float":"left"}},r=new Element("form",{action:o,method:"post"}).adopt([new Element("div",a).set("text",Joomla.JText._("COM_FABRIK_FILE_TYPE")),new Element("label").set("html",s),new Element("label").adopt([new Element("input",{type:"radio",name:"excel",value:"0"}),new Element("span").set("text","CSV")]),new Element("br"),new Element("br"),new Element("div",a).appendText(Joomla.JText._("COM_FABRIK_INCLUDE_FILTERS")),new Element("label").set("html",t),new Element("label").adopt([new Element("input",{type:"radio",name:"incfilters",value:"0"}),new Element("span").set("text",Joomla.JText._("JNO"))]),new Element("br"),new Element("div",a).appendText(Joomla.JText._("COM_FABRIK_INCLUDE_DATA")),new Element("label").set("html",n),new Element("label").adopt([new Element("input",{type:"radio",name:"inctabledata",value:"0"}),new Element("span").set("text",Joomla.JText._("JNO"))]),new Element("br"),new Element("div",a).appendText(Joomla.JText._("COM_FABRIK_INCLUDE_RAW_DATA")),new Element("label").set("html",e),new Element("label").adopt([new Element("input",{type:"radio",name:"incraw",value:"0"}),new Element("span").set("text",Joomla.JText._("JNO"))]),new Element("br"),new Element("div",a).appendText(Joomla.JText._("COM_FABRIK_INCLUDE_CALCULATIONS")),new Element("label").set("html",i),new Element("label").adopt([new Element("input",{type:"radio",name:"inccalcs",value:"0"}),new Element("span").set("text",Joomla.JText._("JNO"))])]);new Element("h4").set("text",Joomla.JText._("COM_FABRIK_SELECT_COLUMNS_TO_EXPORT")).inject(r);var l="",c=0;return $H(this.options.labels).each(function(t,e){if("fabrik_"!==e.substr(0,7)&&"____form_heading"!==e){var i=e.split("___")[0];i!==l&&(l=i,new Element("h5").set("text",l).inject(r));var n="<input type='radio' value='1' name='fields["+e+"]' checked='checked' />"+Joomla.JText._("JYES");t=t.replace(/<\/?[^>]+(>|$)/g,"");var s=new Element("div",a).appendText(t);s.inject(r),new Element("label").set("html",n).inject(r),new Element("label").adopt([new Element("input",{type:"radio",name:"fields["+e+"]",value:"0"}),new Element("span").appendText(Joomla.JText._("JNO"))]).inject(r),new Element("br").inject(r)}c++}.bind(this)),this.options.formels.length>0&&(new Element("h5").set("text",Joomla.JText._("COM_FABRIK_FORM_FIELDS")).inject(r),this.options.formels.each(function(t){var e="<input type='radio' value='1' name='fields["+t.name+"]' checked='checked' />"+Joomla.JText._("JYES"),i=new Element("div",a).appendText(t.label);i.inject(r),new Element("label").set("html",e).inject(r),new Element("label").adopt([new Element("input",{type:"radio",name:"fields["+t.name+"]",value:"0"}),new Element("span").set("text",Joomla.JText._("JNO"))]).inject(r),new Element("br").inject(r)}.bind(this))),new Element("div",{styles:{"text-align":"right"}}).adopt(new Element("input",{type:"button",name:"submit",value:Joomla.JText._("COM_FABRIK_EXPORT"),"class":"button exportCSVButton",events:{click:function(t){t.stop(),t.target.disabled=!0;var e=document.id("csvmsg");"null"===typeOf(e)&&(e=new Element("div",{id:"csvmsg"}).inject(t.target,"before")),e.set("html",Joomla.JText._("COM_FABRIK_LOADING")+' <br /><span id="csvcount">0</span> / <span id="csvtotal"></span> '+Joomla.JText._("COM_FABRIK_RECORDS")+".<br/>"+Joomla.JText._("COM_FABRIK_SAVING_TO")+'<span id="csvfile"></span>'),this.triggerCSVExport(0)}.bind(this)}})).inject(r),new Element("input",{type:"hidden",name:"view",value:"table"}).inject(r),new Element("input",{type:"hidden",name:"option",value:"com_fabrik"}).inject(r),new Element("input",{type:"hidden",name:"listid",value:this.id}).inject(r),new Element("input",{type:"hidden",name:"format",value:"csv"}).inject(r),new Element("input",{type:"hidden",name:"c",value:"table"}).inject(r),r},triggerCSVExport:function(t,e,i){0!==t?-1===t?(t=0,e=this.csvopts,e.fields=this.csvfields):(e=this.csvopts,i=this.csvfields):(e||(e={},"null"!==typeOf(document.id("exportcsv"))&&["incfilters","inctabledata","incraw","inccalcs","excel"].each(function(t){var i=document.id("exportcsv").getElements("input[name="+t+"]");i.length>0&&(e[t]=i.filter(function(t){return t.checked})[0].value)})),i||(i={},"null"!==typeOf(document.id("exportcsv"))&&document.id("exportcsv").getElements("input[name^=field]").each(function(t){if(t.checked){var e=t.name.replace("fields[","").replace("]","");i[e]=t.get("value")}})),e.fields=i,this.csvopts=e,this.csvfields=i),e=this.csvExportFilterOpts(e),e.start=t,e.option="com_fabrik",e.view="list",e.format="csv",e.Itemid=this.options.Itemid,e.listid=this.id,e.listref=this.options.listRef,e.setListRefFromRequest=1,this.options.csvOpts.custom_qs.split("&").each(function(t){var i=t.split("=");e[i[0]]=i[1]});var n=new Request.JSON({url:"?"+this.options.csvOpts.custom_qs,method:"post",data:e,onError:function(t,e){fconsole("Fabrik:list:triggerCSVExport error:"+e,t)},onFailure:function(t){fconsole(t)},onComplete:function(t){if(t.err)alert(t.err),Fabrik.Windows.exportcsv.close();else if("null"!==typeOf(document.id("csvcount"))&&document.id("csvcount").set("text",t.count),"null"!==typeOf(document.id("csvtotal"))&&document.id("csvtotal").set("text",t.total),"null"!==typeOf(document.id("csvfile"))&&document.id("csvfile").set("text",t.file),t.count<t.total)this.triggerCSVExport(t.count);else{var e="index.php?option=com_fabrik&view=list&format=csv&listid="+this.id+"&start="+t.count+"&Itemid="+this.options.Itemid,i='<div class="alert alert-success"><h3>'+Joomla.JText._("COM_FABRIK_CSV_COMPLETE");i+='</h3><p><a class="btn btn-success" href="'+e+'"><i class="icon-download"></i> '+Joomla.JText._("COM_FABRIK_CSV_DOWNLOAD_HERE")+"</a></p></div>","null"!==typeOf(document.id("csvmsg"))&&document.id("csvmsg").set("html",i),this.csvWindow.fitToContent(!1),document.getElements("input.exportCSVButton").removeProperty("disabled")}}.bind(this)});n.send()},csvExportFilterOpts:function(t){var e,i,n,s=0,o=0,a=["value","condition","join","key","search_type","match","full_words_only","eval","grouped_to_previous","hidden","elementid"];return this.getFilters().each(function(e){i=e.name.split("["),i.length>3&&(n=i[3].replace("]","").toInt(),s=n>s?n:s,"checkbox"===e.get("type")||"radio"===e.get("type")?e.checked&&(t[e.name]=e.get("value")):t[e.name]=e.get("value"))}.bind(this)),s++,Object.each(this.options.advancedFilters,function(i,n){if(a.contains(n))for(o=0,e=0;e<i.length;e++)o=e+s,aName="fabrik___filter[list_"+this.options.listRef+"]["+n+"]["+o+"]",t[aName]=i[e]}.bind(this)),t},addPlugins:function(t){t.each(function(t){t.list=this}.bind(this)),this.plugins=t},firePlugin:function(t){var e=Array.prototype.slice.call(arguments);return e=e.slice(1,e.length),this.plugins.each(function(i){Fabrik.fireEvent(t,[this,e])}.bind(this)),this.result===!1?!1:!0},watchEmpty:function(t){var e=document.id(this.options.form).getElement(".doempty");e&&e.addEvent("click",function(t){t.stop(),confirm(Joomla.JText._("COM_FABRIK_CONFIRM_DROP"))&&this.submit("list.doempty")}.bind(this))},watchOrder:function(){var t=!1,e=document.id(this.options.form).getElements(".fabrikorder, .fabrikorder-asc, .fabrikorder-desc");e.removeEvents("click"),e.each(function(e){e.addEvent("click",function(i){var n,s="ordernone.png",o="",a="";e=document.id(i.target);var r=e.getParent(".fabrik_ordercell");switch("a"!==e.tagName&&(e=r.getElement("a")),e.className){case"fabrikorder-asc":a="fabrikorder-desc",n="icon-arrow-down-3",o="desc",s="orderdesc.png";break;case"fabrikorder-desc":a="fabrikorder",n="icon-menu-2",o="-",s="ordernone.png";break;case"fabrikorder":a="fabrikorder-asc",n="icon-arrow-up-3",o="asc",s="orderasc.png"}if(r.className.split(" ").each(function(e){e.contains("_order")&&(t=e.replace("_order","").replace(/^\s+/g,"").replace(/\s+$/g,""))}),!t)return void fconsole("Fabrik:list:watchorder:click: Could not find fabrik elementid to order by");e.className=a;var l=e.getElement("img"),c=e.getElement('*[class^="icon-"]');this.options.singleOrdering&&document.id(this.options.form).getElements(".fabrikorder, .fabrikorder-asc, .fabrikorder-desc").each(function(t){if(Fabrik.bootstrapped){var e=t.getElement('*[class^="icon-"]');e.className="icon-menu-2"}else{var i=t.getElement("img");i&&(i.src=i.src.replace("ordernone.png","").replace("orderasc.png","").replace("orderdesc.png",""),i.src+="ordernone.png")}}),Fabrik.bootstrapped?c.className=n:l&&(l.src=l.src.replace("ordernone.png","").replace("orderasc.png","").replace("orderdesc.png",""),l.src+=s),this.fabrikNavOrder(t,o),i.stop()}.bind(this))}.bind(this))},getFilters:function(){return document.id(this.options.form).getElements(".fabrik_filter")},storeCurrentValue:function(){this.getFilters().each(function(t){"submitform"!==this.options.filterMethod&&t.store("initialvalue",t.get("value"))}.bind(this))},watchFilters:function(){var t="",e=document.id(this.options.form).getElements(".fabrik_filter_submit");this.getFilters().each(function(i){t="select"===i.get("tag")?"change":"blur","submitform"!==this.options.filterMethod?(i.removeEvent(t),i.addEvent(t,function(t){t.stop(),t.target.retrieve("initialvalue")!==t.target.get("value")&&this.doFilter()}.bind(this))):i.addEvent(t,function(t){e.highlight("#ffaa00")}.bind(this))}.bind(this)),e&&(e.removeEvents(),e.addEvent("click",function(t){t.stop(),this.doFilter()}.bind(this))),this.getFilters().addEvent("keydown",function(t){13===t.code&&(t.stop(),this.doFilter())}.bind(this))},doFilter:function(){var t=Fabrik.fireEvent("list.filter",[this]).eventResults;"null"===typeOf(t)&&this.submit("list.filter"),0!==t.length&&t.contains(!1)||this.submit("list.filter")},setActive:function(t){this.list.getElements(".fabrik_row").each(function(t){t.removeClass("activeRow")}),t.addClass("activeRow")},getActiveRow:function(t){var e=t.target.getParent(".fabrik_row");return e||(e=Fabrik.activeRow),e},watchRows:function(){this.list&&this.rowClicks()},getForm:function(){return this.form||(this.form=document.id(this.options.form)),this.form},uncheckAll:function(){this.form.getElements("input[name^=ids]").each(function(t){t.checked=""})},submit:function(t){switch(this.getForm(),t){case"list.delete":var e=!1,i=0;if(this.form.getElements("input[name^=ids]").each(function(t){t.checked&&(i++,e=!0)}),!e)return alert(Joomla.JText._("COM_FABRIK_SELECT_ROWS_FOR_DELETION")),!1;var n=1===i?Joomla.JText._("COM_FABRIK_CONFIRM_DELETE_1"):Joomla.JText._("COM_FABRIK_CONFIRM_DELETE").replace("%s",i);if(!confirm(n))return this.uncheckAll(),!1;break;case"list.filter":Fabrik["filter_listform_"+this.options.listRef].onSubmit(),this.form.task.value=t,this.form["limitstart"+this.id]&&(this.form.getElement("#limitstart"+this.id).value=0);break;default:""!==t&&(this.form.task.value=t)}if(Fabrik.fireEvent("fabrik.list.submit",[t,this.form.toQueryString().toObject()]),!this.result)return this.result=!0,!1;if(this.options.ajax){this.form.getElement("input[name=option]").value="com_fabrik",this.form.getElement("input[name=view]").value="list",this.form.getElement("input[name=format]").value="raw";var s=this.form.toQueryString();if("list.filter"===t&&this.advancedSearch!==!1){var o=document.getElement("form.advancedSeach_"+this.options.listRef);"null"!==typeOf(o)&&(s+="&"+o.toQueryString(),s+="&replacefilters=1")}for(var a=0;a<this.options.fabrik_show_in_list.length;a++)s+="&fabrik_show_in_list[]="+this.options.fabrik_show_in_list[a];if(s+="&tmpl="+this.options.tmpl,Fabrik.fireEvent("fabrik.list.submit.ajax.start",[t,this.form.toQueryString().toObject()]),!this.result)return this.result=!0,!1;this.request?(this.request.cancel(),this.request.options.data=s):this.request=new Request({url:this.form.get("action"),data:s,onRequest:function(){Fabrik.loader.start("listform_"+this.options.listRef)}.bind(this),onCancel:function(){Fabrik.loader.stop("listform_"+this.options.listRef),this.request=null}.bind(this),onFailure:function(t){fconsole("Fabrik:list:submit Ajax failure: Code "+t.status+": "+t.statusText),this.request=null}.bind(this),onComplete:function(t){t=JSON.decode(t),this._updateRows(t),Fabrik.loader.stop("listform_"+this.options.listRef),Fabrik["filter_listform_"+this.options.listRef].onUpdateData(),Fabrik.fireEvent("fabrik.list.submit.ajax.complete",[this,t]),t.msg&&fconsole("Fabrik:list:submit:onComplete: json msg:"+t.msg)}.bind(this)}),this.request.send(),window.history&&window.history.pushState&&history.pushState(s,"fabrik.list.submit"),Fabrik.fireEvent("fabrik.list.submit",[t,this.form.toQueryString().toObject()])}else this.form.submit();return!1},fabrikNav:function(t){return this.options.limitStart=t,this.form.getElement("#limitstart"+this.id).value=t,Fabrik.fireEvent("fabrik.list.navigate",[this,t]),this.result?(this.submit("list.view"),!1):(this.result=!0,!1)},getRowIds:function(){var t=[],e=this.options.isGrouped?$H(this.options.data):this.options.data;return e.each(function(e){e.each(function(e){t.push(e.data.__pk_val)})}),t},getRow:function(t){var e={};return Object.each(this.options.data,function(i){for(var n=0;n<i.length;n++){var s=i[n];s&&s.data.__pk_val===t&&(e=s.data)}}),e},fabrikNavOrder:function(t,e){return this.form.orderby.value=t,this.form.orderdir.value=e,Fabrik.fireEvent("fabrik.list.order",[this,t,e]),this.result?void this.submit("list.order"):(this.result=!0,!1)},removeRows:function(t){for(i=0;i<t.length;i++){var e=document.id("list_"+this.id+"_row_"+t[i]),n=new Fx.Morph(e,{duration:1e3});n.start({backgroundColor:this.options.hightLight}).chain(function(){this.start({opacity:0})}).chain(function(){e.dispose(),this.checkEmpty()}.bind(this))}},editRow:function(){},clearRows:function(){this.list.getElements(".fabrik_row").each(function(t){t.dispose()})},updateRows:function(){var t={option:"com_fabrik",view:"list",task:"list.view",format:"raw",listid:this.id,group_by:this.options.groupedBy,listref:this.options.listRef},e="";t["limit"+this.id]=this.options.limitLength,new Request.JSON({url:e,data:t,onSuccess:function(t){this._updateRows(t)}.bind(this),onError:function(t,e){fconsole(t,e)},onFailure:function(t){fconsole(t)}}).send()},setRowTemplate:function(){if("string"===typeOf(this.options.rowtemplate)){var t=this.list.getElement(".fabrik_row");window.ie&&"null"!==typeOf(t)&&(this.options.rowtemplate=t)}},_updateRows:function(t){var e;if("object"!==typeOf(t))return void(Fabrik.debug&&fconsole("Fabrik:list:_updaterows: data not object"));if(window.history&&window.history.pushState&&history.pushState(t,"fabrik.list.rows"),t.id===this.id&&"list"===t.model){var n=document.id(this.options.form).getElements(".fabrik___heading").getLast(),s=new Hash(t.headings);s.each(function(t,e){e="."+e;try{"null"!==typeOf(n.getElement(e))&&n.getElement(e).getElement("span").set("html",t)}catch(i){fconsole(i)}}),this.setRowTemplate(),this.clearRows();var o=0,a=0;trs=[],this.options.data=this.options.isGrouped?$H(t.data):t.data,t.calculations&&this.updateCals(t.calculations),"null"!==typeOf(this.form.getElement(".fabrikNav"))&&this.form.getElement(".fabrikNav").set("html",t.htmlnav);var r=this.options.isGrouped||""!==this.options.groupedBy?$H(t.data):t.data,l=0;r.each(function(t,n){var s,r;if(e=this.options.isGrouped?this.list.getElements(".fabrik_groupdata")[l]:this.tbody,this.options.isGrouped&&e&&(groupHeading=e.getPrevious(),groupHeading.getElement(".groupTitle").set("html",t[0].groupHeading)),"null"!==typeOf(e))for(l++,i=0;i<t.length;i++){"string"===typeOf(this.options.rowtemplate)?(s="<tr"===this.options.rowtemplate.trim().slice(0,3)?"table":"div",r=new Element(s),r.set("html",this.options.rowtemplate)):(s="tr"===this.options.rowtemplate.get("tag")?"table":"div",r=new Element(s),r.adopt(this.options.rowtemplate.clone()));var c=$H(t[i]);if($H(c.data).each(function(t,e){var i="."+e,n=r.getElement(i);"null"!==typeOf(n)&&"a"!==n.get("tag")&&n.set("html",t),a++}.bind(this)),r.getElement(".fabrik_row").id=c.id,"string"===typeOf(this.options.rowtemplate)){var h=r.getElement(".fabrik_row").clone();h.id=c.id;var d=c["class"].split(" ");for(j=0;j<d.length;j++)h.addClass(d[j]);h.inject(e)}else{var p=r.getElement(".fabrik_row");p.inject(e),r.empty()}o++}}.bind(this));var c=this.list.getElements("tbody");c.setStyle("display",""),c.each(function(t){if(!t.hasClass("fabrik_groupdata")){var e=t.getNext();"null"!==typeOf(e)&&0===e.getElements(".fabrik_row").length&&(t.hide(),e.hide())}});var h=this.list.getParent(".fabrikDataContainer"),d=this.list.getParent(".fabrikForm").getElement(".emptyDataMessage");0===a?"null"!==typeOf(d)&&(d.setStyle("display",""),"none"===d.getParent().getStyle("display")&&d.getParent().setStyle("display",""),d.getElement(".emptyDataMessage")&&d.getElement(".emptyDataMessage").setStyle("display","")):("null"!==typeOf(h)&&h.setStyle("display",""),"null"!==typeOf(d)&&d.setStyle("display","none")),"null"!==typeOf(this.form.getElement(".fabrikNav"))&&this.form.getElement(".fabrikNav").set("html",t.htmlnav),this.watchAll(!0),Fabrik.fireEvent("fabrik.list.updaterows"),Fabrik.fireEvent("fabrik.list.update",[this,t])}this.stripe(),this.mediaScan()},mediaScan:function(){"undefined"!=typeof Slimbox&&Slimbox.scanPage(),"undefined"!=typeof Lightbox&&Lightbox.init(),"undefined"!=typeof Mediabox&&Mediabox.scanPage()},addRow:function(t){var e=new Element("tr",{"class":"oddRow1"});for(var i in t)if(-1!==this.options.headings.indexOf(i)){var n=new Element("td",{}).appendText(t[i]);e.appendChild(n)}e.inject(this.tbody)},addRows:function(t){for(i=0;i<t.length;i++)for(j=0;j<t[i].length;j++)this.addRow(t[i][j]);this.stripe()},stripe:function(){var t=this.list.getElements(".fabrik_row");for(i=0;i<t.length;i++)if(!t[i].hasClass("fabrik___header")){var e="oddRow"+i%2;t[i].addClass(e)}},checkEmpty:function(){var t=this.list.getElements("tr");2===t.length&&this.addRow({label:Joomla.JText._("COM_FABRIK_NO_RECORDS")})},watchCheckAll:function(t){var e=this.form.getElement("input[name=checkAll]");"null"!==typeOf(e)&&e.addEvent("click",function(t){var e=this.list.getParent(".fabrikList")?this.list.getParent(".fabrikList"):this.list,i=e.getElements("input[name^=ids]");c=t.target.checked?"checked":"";for(var n=0;n<i.length;n++)i[n].checked=c,this.toggleJoinKeysChx(i[n])}.bind(this)),this.form.getElements("input[name^=ids]").each(function(t){t.addEvent("change",function(e){this.toggleJoinKeysChx(t)}.bind(this))}.bind(this))},toggleJoinKeysChx:function(t){t.getParent().getElements("input[class=fabrik_joinedkey]").each(function(e){e.checked=t.checked})},watchNav:function(t){if(null!==this.form)var e=this.form.getElement("select[name*=limit]"),i=this.form.getElement(".addRecord");else e=null,i=null;if(e&&e.addEvent("change",function(t){Fabrik.fireEvent("fabrik.list.limit",[this]);return this.result===!1?(this.result=!0,!1):void this.doFilter()}.bind(this)),"null"!==typeOf(i)&&this.options.ajax_links){i.removeEvents();var n=""===this.options.links.add||i.href.contains(Fabrik.liveSite)?"xhr":"iframe",s=i.href;s+=s.contains("?")?"&":"?",s+="tmpl=component&ajax=1",i.addEvent("click",function(t){t.stop();var e={id:"add."+this.id,title:this.options.popup_add_label,loadMethod:n,contentURL:s,width:this.options.popup_width,height:this.options.popup_height};"null"!==typeOf(this.options.popup_offset_x)&&(e.offset_x=this.options.popup_offset_x),"null"!==typeOf(this.options.popup_offset_y)&&(e.offset_y=this.options.popup_offset_y),Fabrik.getWindow(e)}.bind(this))}if(document.id("fabrik__swaptable")&&document.id("fabrik__swaptable").addEvent("change",function(t){window.location="index.php?option=com_fabrik&task=list.view&cid="+t.target.get("value")}.bind(this)),"null"!==typeOf(this.form.getElement(".pagination"))){var o=this.form.getElement(".pagination").getElements(".pagenav");0===o.length&&(o=this.form.getElement(".pagination").getElements("a")),o.each(function(t){t.addEvent("click",function(e){if(e.stop(),"a"===t.get("tag")){var i=t.href.toObject();this.fabrikNav(i["limitstart"+this.id])}}.bind(this))}.bind(this))}this.watchCheckAll()},updateCals:function(t){var e=["sums","avgs","count","medians"];this.form.getElements(".fabrik_calculations").each(function(i){e.each(function(e){$H(t[e]).each(function(t,e){var n=i.getElement("."+e);"null"!==typeOf(n)&&n.set("html",t)})})})}}),FbListKeys=new Class({initialize:function(t){window.addEvent("keyup",function(e){if(e.alt)switch(e.key){case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_ADD"):var i=t.form.getElement(".addRecord");t.options.ajax&&i.fireEvent("click"),i.getElement("a")?t.options.ajax?i.getElement("a").fireEvent("click"):document.location=i.getElement("a").get("href"):t.options.ajax||(document.location=i.get("href"));break;case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_EDIT"):Fabrik.debug&&fconsole("edit");break;case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_DELETE"):Fabrik.debug&&fconsole("delete");break;case Joomla.JText._("COM_FABRIK_LIST_SHORTCUTS_FILTER"):Fabrik.debug&&fconsole("filter")}}.bind(this))}}),FbGroupedToggler=new Class({Implements:Options,options:{collapseOthers:!1,startCollapsed:!1,bootstrap:!1},initialize:function(t,e){var i,n,s,o;"null"!==typeOf(t)&&(this.setOptions(e),this.container=t,this.toggleState="shown",this.options.startCollapsed&&this.options.isGrouped&&this.collapse(),t.addEvent("click:relay(.fabrik_groupheading a.toggle)",function(t){return t.rightClick?void 0:(t.stop(),t.preventDefault(),this.options.collapseOthers&&this.collapse(),n=t.target.getParent(".fabrik_groupheading"),s=n.getElement(this.options.bootstrap?"i":"img"),o=s.retrieve("showgroup",!0),i=n.getNext()&&n.getNext().hasClass("fabrik_groupdata")?n.getNext():n.getParent().getNext(),o?i.hide():i.show(),this.setIcon(s,o),o=o?!1:!0,s.store("showgroup",o),!1)}.bind(this)))},setIcon:function(t,e){this.options.bootstrap?e?(t.addClass("icon-arrow-right"),t.removeClass("icon-arrow-down")):(t.removeClass("icon-arrow-right"),t.addClass("icon-arrow-down")):e?t.src=t.src.replace("orderasc","orderneutral"):t.src=t.src.replace("orderneutral","orderasc")},collapse:function(){this.container.getElements(".fabrik_groupdata").hide();var t=this.options.bootstrap?"i":"img",e=this.container.getElements(".fabrik_groupheading a "+t);0===e.length&&(e=this.container.getElements(".fabrik_groupheading "+t)),e.each(function(t){t.store("showgroup",!1),this.setIcon(t,!0)}.bind(this))},expand:function(){this.container.getElements(".fabrik_groupdata").show();var t=this.container.getElements(".fabrik_groupheading a img");0===t.length&&(t=this.container.getElements(".fabrik_groupheading img")),t.each(function(t){t.store("showgroup",!0),this.setIcon(t,!1)}.bind(this))},toggle:function(){"shown"===this.toggleState?this.collapse():this.expand(),this.toggleState="shown"===this.toggleState?"hidden":"shown"}}),FbListActions=new Class({Implements:[Options],options:{selector:"ul.fabrik_action, .btn-group.fabrik_action",method:"floating",floatPos:"bottom"},initialize:function(t,e){this.setOptions(e),this.list=t,this.actions=[],this.setUpSubMenus(),Fabrik.addEvent("fabrik.list.update",function(t,e){this.observe()}.bind(this)),this.observe()},observe:function(){"floating"===this.options.method?this.setUpFloating():this.setUpDefault()},setUpSubMenus:function(){this.list.form&&(this.actions=this.list.form.getElements(this.options.selector),this.actions.each(function(t){if(t.getElement("ul")){var e=t.getElement("ul"),i=new Element("div").adopt(e.clone()),n=e.getPrevious();n.getElement(".fabrikTip")&&(n=n.getElement(".fabrikTip"));{var s=Fabrik.tips?Fabrik.tips.options:{},o=Object.merge(Object.clone(s),{showOn:"click",hideOn:"click",position:"bottom",content:i});new FloatingTips(n,o)}e.dispose()}}))},setUpDefault:function(){this.actions=this.list.form.getElements(this.options.selector),this.actions.each(function(t){if(!t.getParent().hasClass("fabrik_buttons")){t.fade(.6);var e=t.getParent(t.getParent(".fabrik_row")?".fabrik_row":".fabrik___heading");e&&e.addEvents({mouseenter:function(e){t.fade(.99)},mouseleave:function(e){t.fade(.6)}})}})},setUpFloating:function(){var t=!1;this.list.form.getElements(this.options.selector).each(function(e){if(e.getParent(".fabrik_row")&&(i=e.getParent(".fabrik_row").getElement("input[type=checkbox]"))){t=!0;{var n=function(t,i){var n=e.getParent();return n.store("activeRow",e.getParent(".fabrik_row")),n}.bind(this.list),s={position:this.options.floatPos,showOn:"change",hideOn:"click",content:n,heading:"Edit: ",hideFn:function(t){return!t.target.checked},showFn:function(t,i){return Fabrik.activeRow=e.getParent().retrieve("activeRow"),i.store("list",this.list),t.target.checked}.bind(this.list)},o=Fabrik.tips?Object.merge(Object.clone(Fabrik.tips.options),s):s;new FloatingTips(i,o)}}}.bind(this)),this.list.form.getElements(".fabrik_select input[type=checkbox]").addEvent("click",function(t){Fabrik.activeRow=t.target.getParent(".fabrik_row")});var e=this.list.form.getElement("input[name=checkAll]");"null"!==typeOf(e)&&e.store("listid",this.list.id);{var n=function(t){var e=t.getParent(".fabrik___heading");return"null"!==typeOf(e)?e.getElement(this.options.selector):""}.bind(this),s=Fabrik.tips?Object.clone(Fabrik.tips.options):{},o=Object.merge(s,{position:this.options.floatPos,html:!0,showOn:"click",hideOn:"click",content:n,heading:"Edit all: ",hideFn:function(t){return!t.target.checked},showFn:function(t,e){return e.retrieve("tip").click.store("list",this.list),t.target.checked}.bind(this.list)});new FloatingTips(e,o)}if(this.list.form.getElements(".fabrik_actions")&&t&&this.list.form.getElements(".fabrik_actions").hide(),this.list.form.getElements(".fabrik_calculation")){var a=this.list.form.getElements(".fabrik_calculation").getLast();"null"!==typeOf(a)&&a.hide()}}});